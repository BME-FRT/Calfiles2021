;last modified 11/24/2023 7:48:24 PM by adama    (50)

[2023_Yaw]

/////Cornering radius

c_radius=Power(#v_x, 2)
c_radius=/(#c_radius,#AccY_Bosch)
c_radius=/(#c_radius,9.81)
c_radius=F(#c_radius,F(AVG 20))
c_radius=Set(Dim='m')
c_radius=Limit(#c_radius, -100, 100)

////
Wheel_Angle_Real=/(#STA1_position,Parameters.STEERING_RATIO)

Wheel_Angle_Virtual=/(Parameters.WHEELBASE,#c_radius)    // Wheel_Angle_Virtual=ArcTan(Wheelbase/c_radius)
Wheel_Angle_Virtual=ArcTan(#Wheel_Angle_Virtual)
Wheel_Angle_Virtual=*(#Wheel_Angle_Virtual,@RAD2DEG)
Wheel_Angle_Virtual=If(#VehicleSpeed,<,5,#Wheel_Angle_Real,#Wheel_Angle_Virtual)
Wheel_Angle_Virtual=F(#Wheel_Angle_Virtual,F(AVG 10))
Wheel_Angle_Virtual=Set(Dim='°')

Handling=/(#Wheel_Angle_Virtual,#Wheel_Angle_Real)
Handling=-(#Handling,1)
Handling=If(#VehicleSpeed,>,5,#Handling,0)
c1=Abs(#Wheel_Angle_Real)
Handling=If(#c1,<,3,0,#Handling)
Handling=Set(Dim='-')

Delete(#AccYaverage)
Delete(#c1)

[YAW]
Yaw=+(#YawRate_Bosch,#YawRate_Bosch)
Yaw=/(#Yaw,2)
Yaw=F(#Yaw,F(AVG 20))
Mz_Real=Derivate(#Yaw)
Mz_Real=*(#Mz_Real,Parameters.I_Z)
Mz_Real=Set(Dim='Nm')

Delete(#Yaw)

/////Yaw calculated from torques at wheels

Mz_1=*(#AMK_TorqueLimit_1,Parameters.PLANETARY_GEAR_RATIO)
Mz_1=*(#Mz_1,Parameters.TRACK_FRONT)
Mz_1=/(#Mz_1,-2)
Mz_1=/(#Mz_1,Parameters.WHEEL_RADIUS)

Mz_2=*(#AMK_TorqueLimit_2,Parameters.PLANETARY_GEAR_RATIO)
Mz_2=*(#Mz_2,Parameters.TRACK_FRONT)
Mz_2=/(#Mz_2,2)
Mz_2=/(#Mz_2,Parameters.WHEEL_RADIUS)

Mz_3=*(#AMK_TorqueLimit_3,Parameters.PLANETARY_GEAR_RATIO)
Mz_3=*(#Mz_3,Parameters.TRACK_REAR)
Mz_3=/(#Mz_3,-2)
Mz_3=/(#Mz_3,Parameters.WHEEL_RADIUS)

Mz_4=*(#AMK_TorqueLimit_4,Parameters.PLANETARY_GEAR_RATIO)
Mz_4=*(#Mz_4,Parameters.TRACK_REAR)
Mz_4=/(#Mz_4,2)
Mz_4=/(#Mz_4,Parameters.WHEEL_RADIUS)

M_Yaw=+(#Mz_1,#Mz_2)
M_Yaw=+(#M_Yaw,#Mz_3)
M_Yaw=+(#M_Yaw,#Mz_4)

Delete(#Mz_1)
Delete(#Mz_2)
Delete(#Mz_3)
Delete(#Mz_4)

[Yaw_rate_des]
k_us_v2=/(#E_Kinetic, 22.8)
tmp = *(#k_us_v2,Parameters.BIAS)
tmp = *(#tmp,2)
k_us_v2 = -(#tmp,#k_us_v2)
Yaw_Rate_Desired = +(Parameters.WHEELBASE, #k_us_v2)
Yaw_Rate_Desired = /(#VehicleSpeed, #Yaw_Rate_Desired)
Yaw_Rate_Desired = *(#Wheel_Angle_Real, #Yaw_Rate_Desired)
Yaw_Rate_Desired = *(#Yaw_Rate_Desired , 0.5)
Yaw_Rate_Desired = Set(DIM='deg/s')

//Delete(#k_us_v2)
Delete(#tmp)

Yaw_Rate_Error = -(#Yaw_Rate_Desired,#YawRate_Bosch)



Target_Yaw_Rate=*(#v_x,-0.0000008777)//(0.48/cf-0.52/cr)
Target_Yaw_Rate=*(#Target_Yaw_Rate,Parameters.MASS)
Target_Yaw_Rate=*(#Target_Yaw_Rate,#v_x)
Target_Yaw_Rate=+(#Target_Yaw_Rate,Parameters.WHEELBASE)
Target_Yaw_Rate=/(1,#Target_Yaw_Rate)
Target_Yaw_Rate=*(#Target_Yaw_Rate,#STA1_position)
Target_Yaw_Rate=/(#Target_Yaw_Rate,Parameters.STEERING_RATIO)
Target_Yaw_Rate=*(#Target_Yaw_Rate,@deg2rad)
Target_Yaw_Rate=*(#Target_Yaw_Rate,#v_x)


